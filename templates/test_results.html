
{% extends 'base.html' %}
{% block header %}
  <h1>{% block title %}Results{% endblock %}</h1>
{% endblock %}

{% block content %}
    <div class="container">
        <!-- The results get posted here -->
        <div class="ui top attached tabular menu">
            <a class="active item" data-tab="table">Table</a>
            <a class="item" data-tab="chart">Chart</a>
        </div>
        <div class="ui bottom attached active tab segment" data-tab="table">
            {% if table_result %}
                    <div class="ui two column centered padded grid">
                        <!-- summary results -->
                        <div class="section">
                            <table class="ui very basic collapsing celled table">
                                <thead>
                                    <tr>
                                        <th style="border: 0px !important;"></th>
                                        <th colspan='2' style="border-left: 0px !important;">Dates</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td ></td>
                                        <td style="border: 0px !important;">
                                            <h4 class="ui header">
                                                <div class="content">
                                                    Date of Birth
                                                    <div class="sub header"></div>
                                                </div>
                                            </h4>
                                        </td>
                                        <td>
                                            {{table_result[0].birth_data.birth_date}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 0px !important;"></td>
                                        <td style="border-left: 0px !important;">
                                            <h4 class="ui header">
                                                <div class="content">
                                                    Date of measurement
                                                    <div class="sub header"></div>
                                                </div>
                                            </h4>
                                        </td>
                                        <td>
                                            {{table_result[0].measurement_dates.observation_date}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 0px !important;"></td>
                                        <td style="border-left: 0px !important;">
                                            <h4 class="ui header">
                                                <div class="content">
                                                    Sex
                                                    <div class="sub header"></div>
                                                </div>
                                            </h4>
                                        </td>
                                        <td>
                                            {{table_result[0].birth_data.sex}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 0px !important;" id="gestational_age_delivery_explain">
                                            <i class="info green circle icon"></i>
                                        </td>
                                        <td style="border-left: 0px !important;">
                                            <h4 class="ui header">
                                                <div class="content">
                                                    Gestational Age at Delivery (Postmenstrual age)
                                                    <div class="sub header"></div>
                                                </div>
                                            </h4>
                                        </td>
                                        <td>
                                            {{table_result[0].birth_data.gestation_weeks}}<sup>+{{table_result[0].birth_data.gestation_days}}</sup> weeks
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 0px !important;" id="chronological_decimal_age_explain">
                                            <i class="info green circle icon"></i>
                                        </td>
                                        <td style="border-left: 0px !important;">
                                            <h4 class="ui header">
                                                
                                                <div class="content">
                                                    Chronological Decimal Age
                                                    <div class="sub header">                                
                                                    </div>
                                                </div>
                                            </h4>
                                        </td>
                                        <td>
                                            {{table_result[0].measurement_dates.chronological_decimal_age|round(3)}} y
                                        </td>
                                        <!-- <td class='chronological_decimal_age'>
                                            <i class="info green circle icon"></i>
                                        </td> -->
                                    </tr>
                                    <tr>
                                        <td style="border: 0px !important;" id="corrected_decimal_age_explain">
                                            <i class="info green circle icon"></i>
                                        </td>
                                        <td style="border-left: 0px !important;">
                                            <h4 class="ui image header">
                                                <div class="content">
                                                    Corrected Decimal Age
                                                    <div class="sub header"></div>
                                                </div>
                                            </h4>
                                        </td>
                                        {% if table_result[0].measurement_dates.corrected_decimal_age != 'None' %}
                                        <td>
                                            {{table_result[0].measurement_dates.corrected_decimal_age|round(3)}} y
                                        </td>
                                        <td id='corrected_decimal_age' style="border: 0px !important;">
                                            <i class="info green circle icon"></i>
                                        </td>
                                        {% else %}
                                        <td>
                                            No correction needed
                                        </td>
                                        {% endif %}
                                        <!-- <td class='chronological_decimal_age'>
                                            <i class="info green circle icon"></i>
                                        </td> -->
                                    </tr>
                                    <tr>
                                        <td style="border: 0px !important;" id="chronological_calendar_age_explain">
                                            <i class="info green circle icon"></i>
                                        </td>
                                        <td style="border-left: 0px !important;">
                                            <h4 class="ui image header">
                                                <div class="content">
                                                    <div class="sub header"></div>
                                                    Chronological Calendar Age
                                                </div>
                                            </h4>
                                        </td>
                                        <td>
                                            {{table_result[0].measurement_dates.chronological_calendar_age}}
                                        </td>
                                        <!-- <td class='chronological_decimal_age'>
                                            <i class="info green circle icon"></i>
                                        </td> -->
                                    </tr>
                                    <tr>
                                        <td style="border: 0px !important;" id="corrected_calendar_age_explain">
                                            <i class="info green circle icon"></i>
                                        </td>
                                        <td style="border-left: 0px !important;">
                                        <h4 class="ui image header">
                                            
                                            <div class="content">
                                            Corrected Calendar Age
                                            <div class="sub header">
                                            </div>
                                        </div>
                                        </h4></td>
                                        {% if table_result[0].measurement_dates.corrected_calendar_age %}
                                        <td>
                                            {{table_result[0].measurement_dates.corrected_calendar_age}}
                                        </td>
                                        {% else %}
                                            <td>
                                                No correction needed
                                            </td>
                                        {% endif %}
                                    </tr>
                                    <tr>
                                        <td style="border: 0px !important;" id="estimated_date_delivery_explain">
                                            <i class="info green circle icon"></i>
                                        </td>
                                        <td style="border-left: 0px !important;">
                                        <h4 class="ui image header">
                                            
                                            <div class="content">
                                            Estimated Date of Delivery
                                            <div class="sub header">
                                            </div>
                                        </div>
                                        </h4></td>
                                        {% if table_result[0].birth_data.estimated_date_delivery_string %}
                                        <td>
                                            {{ table_result[0].birth_data.estimated_date_delivery_string }}
                                        </td>
                                        <!-- <td class='chronological_decimal_age'>
                                            <i class="info green circle icon"></i>
                                        </td> -->
                                        {% else %}
                                            <td>
                                                No correction needed
                                            </td>
                                        {% endif %}
                                    </tr>
                                    <tr>
                                        <td style="border: 0px !important;" id="corrected_gestational_age_explain">
                                            <i class="info green circle icon"></i>
                                        </td>
                                        <td style="border-left: 0px !important;">
                                            <h4 class="ui image header">
                                                <div class="content">
                                                Corrected Gestational Age (Postmenstrual Age after birth)
                                                </div>
                                            </h4>
                                        </td>
                                        {% if table_result[0].measurement_dates.corrected_gestational_age.corrected_gestation_weeks %}
                                        <td>
                                            {{table_result[0].measurement_dates.corrected_gestational_age.corrected_gestation_weeks}}<sup>+{{table_result[0].measurement_dates.corrected_gestational_age.corrected_gestation_days}}</sup> weeks
                                        </td>
                                        {% else %}
                                            <td>
                                                No correction needed
                                            </td>
                                        {% endif %}
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- measurement table_results -->
                        <div class="section">
                            <table class="ui very basic collapsing celled table">
                                <thead>
                                    <tr>
                                        <th colspan='2'>Measurements</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <h4 class="ui blue header">
                                                <div class="content">
                                                    Height
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result %}
                                            {% if measurement.child_observation_value.measurement_type == 'height' %}
                                                <td>
                                                    {{ measurement.child_observation_value.measurement_value|round(1) }} cm
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui header">
                                                <div class="content">
                                                    SDS
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result %}
                                        {% if measurement.child_observation_value.measurement_type == 'height' %}
                                            <td>
                                                <div>
                                                    {{ measurement.measurement_calculated_values.sds|round(2) }}
                                                </div>
                                            </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui header">
                                                <div class="content">
                                                    Centile
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result %}
                                            {% if measurement.child_observation_value.measurement_type == 'height' %}
                                                <td>
                                                    <div class="ui blue header">
                                                        {% if (measurement.measurement_calculated_values.centile >99 and measurement.measurement_calculated_values.centile < 100) or (measurement.measurement_calculated_values.centile < 1 and measurement.measurement_calculated_values.centile > 0) %}
                                                            {{ measurement.measurement_calculated_values.centile|round(1) }}
                                                        {% elif measurement.measurement_calculated_values.centile >= 100 %}
                                                            >99.6<sup>th</sup>
                                                        {% elif measurement.measurement_calculated_values.centile <= 0%}
                                                            < 0.4<sup>th</sup>
                                                        {% else %}
                                                            {{ measurement.measurement_calculated_values.centile|round|int}}
                                                        {% endif %}
                                                    </div>
                                                    <td id='height_centile' style="border: 0px !important;">
                                                        <i class="info green circle icon"></i>
                                                    </td>
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui blue header">
                                                <div class="content">
                                                    Weight
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result %}
                                            {% if measurement.child_observation_value.measurement_type == 'weight' %}
                                                <td>
                                                    {{ measurement.child_observation_value.measurement_value|round(2) }} kg
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui header">
                                                <div class="content">
                                                    SDS
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result %}
                                            {% if measurement.child_observation_value.measurement_type == 'weight' %}
                                                <td>
                                                    <div >
                                                        {{ measurement.measurement_calculated_values.sds|round(2) }}
                                                    </div>
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui header">
                                                <div class="content">
                                                    Centile
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result  %}
                                            {% if measurement.child_observation_value.measurement_type == 'weight' %}
                                                <td>
                                                    <div class="ui blue header">
                                                        {% if (measurement.measurement_calculated_values.centile >99 and measurement.measurement_calculated_values.centile < 100) or (measurement.measurement_calculated_values.centile < 1 and measurement.measurement_calculated_values.centile > 0) %}
                                                            {{ measurement.measurement_calculated_values.centile|round(1) }}
                                                        {% elif measurement.measurement_calculated_values.centile >= 100 %}
                                                            >99.6<sup>th</sup>
                                                        {% elif measurement.measurement_calculated_values.centile <= 0%}
                                                            < 0.4<sup>th</sup>
                                                        {% else %}
                                                            {{ measurement.measurement_calculated_values.centile|round|int}}
                                                        {% endif %}
                                                    </div>
                                                </td>
                                                <td id='weight_centile' style=" border: 0px !important;">
                                                    <i class="info green circle icon"></i>
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui blue header">
                                                <div class="content">
                                                    BMI
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result  %}
                                            {% if measurement.child_observation_value.measurement_type == 'bmi' %}
                                                <td>
                                                    {{ measurement.child_observation_value.measurement_value|round(1) }} kg/m&#178;
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui header">
                                                <div class="content">
                                                    SDS
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result %}
                                            {% if measurement.child_observation_value.measurement_type == 'bmi' %}
                                                <td>
                                                    <div>
                                                        {{ measurement.measurement_calculated_values.sds|round(2) }}
                                                    </div>
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui header">
                                                <div class="content">
                                                    Centile
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result %}
                                            {% if measurement.child_observation_value.measurement_type == 'bmi' %}
                                                    <td>
                                                        <div class="ui blue header">
                                                            {% if (measurement.measurement_calculated_values.centile >99 and measurement.measurement_calculated_values.centile < 100) or (measurement.measurement_calculated_values.centile < 1 and measurement.measurement_calculated_values.centile > 0) %}
                                                                {{ measurement.measurement_calculated_values.centile|round(1) }}
                                                            {% elif measurement.measurement_calculated_values.centile >= 100 %}
                                                                >99.6<sup>th</sup>
                                                            {% elif measurement.measurement_calculated_values.centile <= 0%}
                                                                < 0.4<sup>th</sup>
                                                            {% else %}
                                                                {{ measurement.measurement_calculated_values.centile|round|int}}
                                                            {% endif %}
                                                        </div>
                                                    </td>
                                                    <td id='bmi_centile' style=" border: 0px !important;">
                                                        <i class="info green circle icon"></i>
                                                    </td>
                                                {% endif %}

                                            {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui blue header">
                                                <div class="content">
                                                    Head Circumference
                                                    <div class="sub header">
                                                    </div>
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result %}
                                            {% if measurement.child_observation_value.measurement_type == 'ofc' %}
                                                <td>
                                                    {{ measurement.child_observation_value.measurement_value }} cm
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui header">
                                                <div class="content">
                                                    SDS
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result %}
                                            {% if measurement.child_observation_value.measurement_type == 'ofc' %}
                                                <td>
                                                    <div>
                                                        {{ measurement.measurement_calculated_values.sds|round(2) }}
                                                    </div>
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    <tr>
                                        <td>
                                            <h4 class="ui header">
                                                <div class="content">
                                                    Centile
                                                </div>
                                            </h4>
                                        </td>
                                        {% for measurement in table_result  %}
                                            {% if measurement.child_observation_value.measurement_type == 'ofc' %}
                                                <td>
                                                    <div class="ui blue header">
                                                        {% if (measurement.measurement_calculated_values.centile >99 and measurement.measurement_calculated_values.centile < 100) or (measurement.measurement_calculated_values.centile < 1 and measurement.measurement_calculated_values.centile > 0) %}
                                                            {{ measurement.measurement_calculated_values.centile|round(1) }}
                                                        {% elif measurement.measurement_calculated_values.centile >= 100 %}
                                                            >99.6<sup>th</sup>
                                                        {% elif measurement.measurement_calculated_values.centile <= 0%}
                                                            < 0.4<sup>th</sup>
                                                        {% else %}
                                                            {{ measurement.measurement_calculated_values.centile|round|int}}
                                                        {% endif %}
                                                    </div>
                                                </td>
                                                <td id='ofc_centile' style=" border: 0px !important; ">
                                                    <i class="info green circle icon"></i>
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
            {% endif %}
        </div>
        <div class="ui bottom attached tab segment" data-tab="chart">
            <!---Charts start here-->
            <div class="ui centered aligned grid">
                <div class="ui container">
                  <canvas id="heightChart" width="200" height="200"></canvas>        
                </div>
                <div class="ui container">
                  <canvas id="weightChart" width="200" height="200"></canvas>        
                </div>
                <div class="ui container">
                  <canvas id="bmiChart" width="200" height="200"></canvas>
                </div>
                <div class="ui container">
                  <canvas id="ofcChart" width="200" height="200"></canvas>
                </div>
              </div>    
        </div>
    </div>
<script>
    ///Javascript code for the table
    $('.tabular.menu .item').tab();
    $('#gestational_age_delivery_explain').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Info: </b>This is the child\'s gestation at birth; it is the number of weeks since the last menstrual period.</p>'
    });
    $('#corrected_decimal_age_explain').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Info: </b>This calculates the child\'s age from their expected due date, not their date of birth. This allows clinicians to compare them with other term babies the same age. It is considered 0 at term (37-42 weeks)</p>'
    });
    $('#chronological_decimal_age_explain').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Info: </b>This reports the child\'s age from birth in years, expressed as a decimal.</p>'
    });
    $('#chronological_calendar_age_explain').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Info: </b>This is the child\'s age from birth in years, months, weeks and days.</p>'
    });
    $('#corrected_calendar_age_explain').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Info: </b>This is the child\'s age from their due date in years, months, weeks and days.</p>'
    });
    $('#estimated_date_delivery_explain').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Info: </b>This is the child\'s due date.</p>'
    });
    $('#corrected_gestational_age_explain').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Info: </b>For babies born preterm, this is their gestational age since birth up until 42 weeks.</p>'
    });
    $('#corrected_decimal_age').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: "<p><b>Clinician: </b>{{table_result[0].measurement_dates.clinician_decimal_age_comment}}</p><p><b>Parent/Carer:</b> {{table_result[0].measurement_dates.lay_decimal_age_comment}}</p>"
    });
    $('#height_centile').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Clinician: </b>{% for measurement in table_result %}{% if measurement.measurement_calculated_values.clinician_height_comment and measurement.child_observation_value.clinician_height_comment is not none %}{{measurement.measurement_calculated_values.clinician_height_comment}}</p><p><b>Parent/Carer:</b> {{measurement.measurement_calculated_values.lay_height_comment}}{%endif%}{%endfor%}</p>'
    });
    $('#weight_centile').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Clinician: </b>{% for measurement in table_result %}{% if measurement.measurement_calculated_values.clinician_weight_comment and measurement.child_observation_value.clinician_weight_comment is not none %}{{measurement.measurement_calculated_values.clinician_weight_comment}}</p><p><b>Parent/Carer:</b> {{measurement.measurement_calculated_values.lay_weight_comment}}{%endif%}{%endfor%}</p>'
    });
    $('#bmi_centile').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Clinician: </b>{% for measurement in table_result %}{% if measurement.measurement_calculated_values.clinician_bmi_comment and measurement.child_observation_value.clinician_bmi_comment is not none %}{{measurement.measurement_calculated_values.clinician_bmi_comment}}</p><p><b>Parent/Carer:</b> {{measurement.measurement_calculated_values.lay_bmi_comment}}{%endif%}{%endfor%}</p>'
    });
    $('#ofc_centile').popup({
        on: 'click',
        setFluidWidth: true,
        variation: 'wide green',
        html: '<p><b>Clinician: </b>{% for measurement in table_result %}{% if measurement.measurement_calculated_values.clinician_ofc_comment and measurement.child_observation_value.clinician_ofc_comment is not none %}{{measurement.measurement_calculated_values.clinician_ofc_comment}}</p><p><b>Parent/Carer:</b> {{measurement.measurement_calculated_values.lay_ofc_comment}}{%endif%}{%endfor%}</p>'
    });

    function returnComment(array, measurement, clinician) {
        for(record in array) {
            console.log(record.measurement_calculated_values.clinician_bmi_comment);
            
        }
    }

    /// javascript for the charts
    var girl = 'rgba(217, 49, 155, 1.0)';
      var boy = 'rgba(0, 126, 198, 1.0)';
      var sex_color = ''
      var height_centiles = []
      var weight_centiles = []
      var bmi_centiles = []
      var ofc_centiles = []
      var max_ticks = 0;
      var measurements = ['height', 'weight', 'bmi', 'ofc'];

      var results = JSON.parse('{{chart_results|tojson|safe}}')
      
      if (results.sex == 'male') {
        sex_color = boy;
      }
      if (results.sex == 'female') {
        sex_color = girl;
      }
      
      // select which centile charts to show
      if(results.child_data.heights.length > 0){
        height_centiles = results.centile_data.height
      }
      if(results.child_data.weights.length > 0){
        weight_centiles = results.centile_data.weight
      }  
      if(results.child_data.bmis.length > 0){
        bmi_centiles = results.centile_data.bmi
      }
      if(results.child_data.ofcs.length > 0){
        ofc_centiles = results.centile_data.ofc
      }
      
    
      for (i=0; i<measurements.length; i++){

        var centile_data_set = [];
        
        // var pointfourth, second, ninth, twenty_fifth, fiftieth, seventy_fifth, ninety_first, ninety_eighth, ninety_ninth = [];
        measurement_label = ''
        axis_label=''

        if(measurements[i] == 'height'){
          // centile_data_set = results.centile_data.height_centiles;
          centile_data_set = height_centiles
          axis_label = "Length/Height (cm)";
          measurement_label = 'Length/Height';
          child_measurement = results.child_data.heights; // child measurements
          max_ticks = 200;
        }
        if(measurements[i] == 'weight') {
          // centile_data_set 
          centile_data_set = weight_centiles;
          axis_label = "Weight (kg)";
          measurement_label = 'Weight';
          child_measurement = results.child_data.weights // child measurements
          max_ticks = 180;
        }
        if(measurements[i] == 'bmi') {
          centile_data_set = bmi_centiles;
          axis_label = "BMI (kg/2)";
          measurement_label = 'Body Mass Index';
          child_measurement = results.child_data.bmis; // child measurements
          max_ticks = 65;
        }
        if(measurements[i] == 'ofc') {
          centile_data_set = ofc_centiles;
          axis_label = "Head Circumference (cm)";
          measurement_label = 'Head Circumference';
          child_measurement = results.child_data.ofcs; // child measurements
          max_ticks = 70;
        }

          var data = {
                // labels:results.data.sds,
                datasets:[ /// preterm to term UK90
                  {
                    label: '0.4th',  /// preterm to term UK90
                    data: centile_data_set[0].uk90_preterm_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '2nd', /// preterm to term UK90
                    data: centile_data_set[1].uk90_preterm_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '9th',  /// preterm to term UK90
                    data: centile_data_set[2].uk90_preterm_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false             
                  },
                  {
                    label: '25th', /// preterm to term UK90
                    data: centile_data_set[3].uk90_preterm_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '50th',  /// preterm to term UK90
                    data: centile_data_set[4].uk90_preterm_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false             
                  },
                  {
                    label: '75th', /// preterm to term UK90
                    data: centile_data_set[5].uk90_preterm_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '91st',  /// preterm to term UK90
                    data: centile_data_set[6].uk90_preterm_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false              
                  },
                  {
                    label: '98th', /// preterm to term UK90
                    data: centile_data_set[7].uk90_preterm_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '99.6th',  /// preterm to term UK90
                    data: centile_data_set[8].uk90_preterm_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  ///term WHO infant data
                  {
                    label: '0.4th',  /// WHO infant 
                    data: centile_data_set[0].who_infant_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '2nd', /// WHO infant 
                    data: centile_data_set[1].who_infant_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '9th',  /// WHO infant 
                    data: centile_data_set[2].who_infant_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '25th', /// WHO infant 
                    data: centile_data_set[3].who_infant_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '50th',  /// WHO infant 
                    data: centile_data_set[4].who_infant_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '75th', /// WHO infant 
                    data: centile_data_set[5].who_infant_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '91st',  /// WHO infant 
                    data: centile_data_set[6].who_infant_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '98th', /// WHO infant 
                    data: centile_data_set[7].who_infant_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '99.6th',  /// WHO infant 
                    data: centile_data_set[8].who_infant_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  //who child
                  {
                    label: '0.4th',  /// who standing data set
                    data: centile_data_set[0].who_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '2nd', /// who standing data set
                    data: centile_data_set[1].who_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '9th',  /// who standing data set
                    data: centile_data_set[2].who_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '25th', /// who standing data set
                    data: centile_data_set[3].who_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '50th',  /// who standing data set
                    data: centile_data_set[4].who_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '75th', /// who standing data set
                    data: centile_data_set[5].who_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '91st',  /// who standing data set
                    data: centile_data_set[6].who_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '98th', /// who standing data set
                    data: centile_data_set[7].who_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '99.6th',  /// who standing data set
                    data: centile_data_set[8].who_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  ////uk90 standing
                  {
                    label: '0.4th',  /// UK90 children
                    data: centile_data_set[0].uk90_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '2nd', /// UK90 children
                    data: centile_data_set[1].uk90_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '9th',  /// UK90 children
                    data: centile_data_set[2].uk90_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '25th', /// UK90 children
                    data: centile_data_set[3].uk90_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '50th',  /// UK90 children
                    data: centile_data_set[4].uk90_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '75th', /// UK90 children
                    data: centile_data_set[5].uk90_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '91st',  /// UK90 children
                    data: centile_data_set[6].uk90_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  {
                    label: '98th', /// UK90 children
                    data: centile_data_set[7].uk90_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    spanGaps: false,
                    pointRadius: 0,
                    lineTension: 0
                  },
                  {
                    label: '99.6th',  /// UK90 children
                    data: centile_data_set[8].uk90_child_data,
                    fill: false,
                    showLine: true,
                    borderColor: sex_color,
                    borderWidth: 0.5,
                    pointStyle: 'dash',
                    borderDash: [15, 5],
                    pointRadius: 0,
                    lineTension: 0,
                    cubicInterpolationMode: false
                  },
                  ///patient data
                  {
                    label: 'Measurement',
                    data: child_measurement,
                    fill: false,
                    borderColor: 'rgba(0, 0, 0, 1.0)',
                    borderWidth: 1.0,
                    pointRadius: 1.0,
                    pointStyle: 'circle',
                  },

                ]
              }

              var options = {
                    title:{
                      display: true,
                      position: 'top',
                      text: measurement_label
                    },
                    legend: {
                      display: false
                    },
                    scales: {
                      xAxes: [{
                        scaleLabel: {
                          display: true,
                          labelString: 'Age (yrs)',
                          fontFamily: "'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",
                          fontStyle: 'bold'
                        },
                        type: 'linear',
                        position: 'bottom',
                        ticks: {
                          min: -0.3,
                          max: 20,
                          stepSize: 0.5,
                          fixedStepSize: 0.5,
                          fontStyle: 'bold'
                        }
                      }],
                      yAxes: [{
                        scaleLabel: {
                          display: true,
                          labelString: axis_label,
                          fontStyle: 'bold'
                        },
                        ticks: {
                          min: 0,
                          max: max_ticks,
                          fontStyle: 'bold'
                        }
                      }]
                    },
                    plugins: {
                      zoom: {
                        // zoom: {
                        //   // Container for pan options
                        //   pan: {
                        //     // Boolean to enable panning
                        //     enabled: true,

                        //     // Panning directions. Remove the appropriate direction to disable
                        //     // Eg. 'y' would only allow panning in the y direction
                        //     // A function that is called as the user is panning and returns the
                        //     // available directions can also be used:
                        //     //   mode: function({ chart }) {
                        //     //     return 'xy';
                        //     //   },
                        //     mode: 'xy',

                        //     rangeMin: {
                        //       // Format of min pan range depends on scale type
                        //       x: null,
                        //       y: null
                        //     },
                        //     rangeMax: {
                        //       // Format of max pan range depends on scale type
                        //       x: null,
                        //       y: null
                        //     },

                        //     // On category scale, factor of pan velocity
                        //     speed: 20,

                        //     // Minimal pan distance required before actually applying pan
                        //     threshold: 10,

                        //     // Function called while the user is panning
                        //     onPan: function({chart}) { console.log(`I'm panning!!!`); },
                        //     // Function called once panning is completed
                        //     onPanComplete: function({chart}) { console.log(`I was panned!!!`); }
                        //   },

                          // Container for zoom options
                          zoom: {
                            // Boolean to enable zooming
                            enabled: true,

                            // Enable drag-to-zoom behavior
                            drag: true,

                            // Drag-to-zoom effect can be customized
                            // drag: {
                            // 	 borderColor: 'rgba(225,225,225,0.3)'
                            // 	 borderWidth: 5,
                            // 	 backgroundColor: 'rgb(225,225,225)',
                            // 	 animationDuration: 0
                            // },

                            // Zooming directions. Remove the appropriate direction to disable
                            // Eg. 'y' would only allow zooming in the y direction
                            // A function that is called as the user is zooming and returns the
                            // available directions can also be used:
                            //   mode: function({ chart }) {
                            //     return 'xy';
                            //   },
                            mode: 'xy',

                            // Speed of zoom via mouse wheel
                            // (percentage of zoom on a wheel event)
                            speed: 0.05,

                            // Minimal zoom distance required before actually applying zoom
                            threshold: 2,

                            // On category scale, minimal zoom level before actually applying zoom
                            sensitivity: 3,

                            // Function called while the user is zooming
                            onZoom: function({chart}) { console.log(`I'm zooming!!!`); },
                            // Function called once zooming is completed
                            onZoomComplete: function({chart}) { console.log(`I was zoomed!!!`); }
                          }
                        } //zoom
                      } //plugins
                    }//options
                  

                if (measurements[i] == 'height'){
                  var heightCtx = document.getElementById('heightChart').getContext('2d');
                  var heightChart = new Chart(heightCtx, {
                    type: 'scatter',
                    data: data,
                    options: options
                  });
                }
                if (measurements[i] == 'weight'){
                  var weightCtx = document.getElementById('weightChart').getContext('2d');
                  var weightChart = new Chart(weightCtx, {
                    type: 'scatter',
                    data: data,
                    options: options
                  });
                }
                if (measurements[i] == 'bmi'){
                  var bmiCtx = document.getElementById('bmiChart').getContext('2d');
                  var bmiChart = new Chart(bmiCtx, {
                    type: 'scatter',
                    data: data,
                    options: options
                  });
                }
                if (measurements[i] == 'ofc'){
                  var ofcCtx = document.getElementById('ofcChart').getContext('2d');
                  var ofcChart = new Chart(ofcCtx, {
                    type: 'scatter',
                    data: data,
                    options: options
                  });
                }
      }


</script>
                
{% endblock %}