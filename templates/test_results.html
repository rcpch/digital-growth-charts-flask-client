
{% extends 'base.html' %}
{% block header %}
  <h1>{% block title %}Results{% endblock %}</h1>
{% endblock %}

{% block content %}

    <!-- The results get posted here -->
    {% if result %}
    <div class="ui two column centered padded grid">

        <!-- summary results -->
        <div class="section">
            <table class="ui very basic collapsing celled table">
                <thead>
                    <tr>
                        <th style="border: 0px !important;"></th>
                        <th colspan='2' style="border-left: 0px !important;">Dates</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td ></td>
                        <td style="border: 0px !important;">
                            <h4 class="ui header">
                                <div class="content">
                                    Date of Birth
                                    <div class="sub header"></div>
                                </div>
                            </h4>
                        </td>
                        <td>
                            {{result[0].birth_data.birth_date}}
                        </td>
                    </tr>
                    <tr>
                        <td style="border: 0px !important;"></td>
                        <td style="border-left: 0px !important;">
                            <h4 class="ui header">
                                <div class="content">
                                    Date of measurement
                                    <div class="sub header"></div>
                                </div>
                            </h4>
                        </td>
                        <td>
                            {{result[0].measurement_dates.observation_date}}
                        </td>
                    </tr>
                    <tr>
                        <td style="border: 0px !important;"></td>
                        <td style="border-left: 0px !important;">
                            <h4 class="ui header">
                                <div class="content">
                                    Sex
                                    <div class="sub header"></div>
                                </div>
                            </h4>
                        </td>
                        <td>
                            {{result[0].birth_data.sex}}
                        </td>
                    </tr>
                    <tr>
                        <td style="border: 0px !important;" id="gestational_age_delivery_explain">
                            <i class="info green circle icon"></i>
                        </td>
                        <td style="border-left: 0px !important;">
                            <h4 class="ui header">
                                <div class="content">
                                    Gestational Age at Delivery (Postmenstrual age)
                                    <div class="sub header"></div>
                                </div>
                            </h4>
                        </td>
                        <td>
                            {{result[0].birth_data.gestation_weeks}}<sup>+{{result[0].birth_data.gestation_days}}</sup> weeks
                        </td>
                    </tr>
                    <tr>
                        <td style="border: 0px !important;" id="chronological_decimal_age_explain">
                            <i class="info green circle icon"></i>
                        </td>
                        <td style="border-left: 0px !important;">
                            <h4 class="ui header">
                                
                                <div class="content">
                                    Chronological Decimal Age
                                    <div class="sub header">                                
                                    </div>
                                </div>
                            </h4>
                        </td>
                        <td>
                            {{result[0].measurement_dates.chronological_decimal_age|round(3)}} y
                        </td>
                        <!-- <td class='chronological_decimal_age'>
                            <i class="info green circle icon"></i>
                        </td> -->
                    </tr>
                    <tr>
                        <td style="border: 0px !important;" id="corrected_decimal_age_explain">
                            <i class="info green circle icon"></i>
                        </td>
                        <td style="border-left: 0px !important;">
                            <h4 class="ui image header">
                                <div class="content">
                                    Corrected Decimal Age
                                    <div class="sub header"></div>
                                </div>
                            </h4>
                        </td>
                        {% if result[0].measurement_dates.corrected_decimal_age != 'None' %}
                        <td>
                            {{result[0].measurement_dates.corrected_decimal_age|round(3)}} y
                        </td>
                        <td id='corrected_decimal_age' style="border: 0px !important;">
                            <i class="info green circle icon"></i>
                        </td>
                        {% else %}
                        <td>
                            No correction needed
                        </td>
                        {% endif %}
                        <!-- <td class='chronological_decimal_age'>
                            <i class="info green circle icon"></i>
                        </td> -->
                    </tr>
                    <tr>
                        <td style="border: 0px !important;" id="chronological_calendar_age_explain">
                            <i class="info green circle icon"></i>
                        </td>
                        <td style="border-left: 0px !important;">
                            <h4 class="ui image header">
                                <div class="content">
                                    <div class="sub header"></div>
                                    Chronological Calendar Age
                                </div>
                            </h4>
                        </td>
                        <td>
                            {{result[0].measurement_dates.chronological_calendar_age}}
                        </td>
                        <!-- <td class='chronological_decimal_age'>
                            <i class="info green circle icon"></i>
                        </td> -->
                    </tr>
                    <tr>
                        <td style="border: 0px !important;" id="corrected_calendar_age_explain">
                            <i class="info green circle icon"></i>
                        </td>
                        <td style="border-left: 0px !important;">
                        <h4 class="ui image header">
                            
                            <div class="content">
                            Corrected Calendar Age
                            <div class="sub header">
                            </div>
                        </div>
                        </h4></td>
                        {% if result[0].measurement_dates.corrected_calendar_age %}
                        <td>
                            {{result[0].measurement_dates.corrected_calendar_age}}
                        </td>
                        {% else %}
                            <td>
                                No correction needed
                            </td>
                        {% endif %}
                    </tr>
                    <tr>
                        <td style="border: 0px !important;" id="estimated_date_delivery_explain">
                            <i class="info green circle icon"></i>
                        </td>
                        <td style="border-left: 0px !important;">
                        <h4 class="ui image header">
                            
                            <div class="content">
                            Estimated Date of Delivery
                            <div class="sub header">
                            </div>
                        </div>
                        </h4></td>
                        {% if result[0].birth_data.estimated_date_delivery_string %}
                        <td>
                            {{ result[0].birth_data.estimated_date_delivery_string }}
                        </td>
                        <!-- <td class='chronological_decimal_age'>
                            <i class="info green circle icon"></i>
                        </td> -->
                        {% else %}
                            <td>
                                No correction needed
                            </td>
                        {% endif %}
                    </tr>
                    <tr>
                        <td style="border: 0px !important;" id="corrected_gestational_age_explain">
                            <i class="info green circle icon"></i>
                        </td>
                        <td style="border-left: 0px !important;">
                            <h4 class="ui image header">
                                <div class="content">
                                Corrected Gestational Age (Postmenstrual Age after birth)
                                </div>
                            </h4>
                        </td>
                        {% if result[0].measurement_dates.corrected_gestational_age.corrected_gestation_weeks %}
                        <td>
                            {{result[0].measurement_dates.corrected_gestational_age.corrected_gestation_weeks}}<sup>+{{result[0].measurement_dates.corrected_gestational_age.corrected_gestation_days}}</sup> weeks
                        </td>
                        {% else %}
                            <td>
                                No correction needed
                            </td>
                        {% endif %}
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- measurement results -->
        <div class="section">
            <table class="ui very basic collapsing celled table">
                <thead>
                    <tr>
                        <th colspan='2'>Measurements</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <h4 class="ui blue header">
                                <div class="content">
                                    Height
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result %}
                            {% if measurement.child_observation_value.measurement_type == 'height' %}
                                <td>
                                    {{ measurement.child_observation_value.measurement_value|round(1) }} cm
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui header">
                                <div class="content">
                                    SDS
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result %}
                        {% if measurement.child_observation_value.measurement_type == 'height' %}
                            <td>
                                <div>
                                    {{ measurement.measurement_calculated_values.sds|round(2) }}
                                </div>
                            </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui header">
                                <div class="content">
                                    Centile
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result %}
                            {% if measurement.child_observation_value.measurement_type == 'height' %}
                                <td>
                                    <div class="ui blue header">
                                        {% if (measurement.measurement_calculated_values.centile >99 and measurement.measurement_calculated_values.centile < 100) or (measurement.measurement_calculated_values.centile < 1 and measurement.measurement_calculated_values.centile > 0) %}
                                            {{ measurement.measurement_calculated_values.centile|round(1) }}
                                        {% elif measurement.measurement_calculated_values.centile >= 100 %}
                                            >99.6<sup>th</sup>
                                        {% elif measurement.measurement_calculated_values.centile <= 0%}
                                            < 0.4<sup>th</sup>
                                        {% else %}
                                            {{ measurement.measurement_calculated_values.centile|round|int}}
                                        {% endif %}
                                    </div>
                                    <td id='height_centile' style="border: 0px !important;">
                                        <i class="info green circle icon"></i>
                                    </td>
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui blue header">
                                <div class="content">
                                    Weight
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result %}
                            {% if measurement.child_observation_value.measurement_type == 'weight' %}
                                <td>
                                    {{ measurement.child_observation_value.measurement_value|round(2) }} kg
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui header">
                                <div class="content">
                                    SDS
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result %}
                            {% if measurement.child_observation_value.measurement_type == 'weight' %}
                                <td>
                                    <div >
                                        {{ measurement.measurement_calculated_values.sds|round(2) }}
                                    </div>
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui header">
                                <div class="content">
                                    Centile
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result  %}
                            {% if measurement.child_observation_value.measurement_type == 'weight' %}
                                <td>
                                    <div class="ui blue header">
                                        {% if (measurement.measurement_calculated_values.centile >99 and measurement.measurement_calculated_values.centile < 100) or (measurement.measurement_calculated_values.centile < 1 and measurement.measurement_calculated_values.centile > 0) %}
                                            {{ measurement.measurement_calculated_values.centile|round(1) }}
                                        {% elif measurement.measurement_calculated_values.centile >= 100 %}
                                            >99.6<sup>th</sup>
                                        {% elif measurement.measurement_calculated_values.centile <= 0%}
                                            < 0.4<sup>th</sup>
                                        {% else %}
                                            {{ measurement.measurement_calculated_values.centile|round|int}}
                                        {% endif %}
                                    </div>
                                </td>
                                <td id='weight_centile' style=" border: 0px !important;">
                                    <i class="info green circle icon"></i>
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui blue header">
                                <div class="content">
                                    BMI
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result  %}
                            {% if measurement.child_observation_value.measurement_type == 'bmi' %}
                                <td>
                                    {{ measurement.child_observation_value.measurement_value|round(1) }} kg/m&#178;
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui header">
                                <div class="content">
                                    SDS
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result %}
                            {% if measurement.child_observation_value.measurement_type == 'bmi' %}
                                <td>
                                    <div>
                                        {{ measurement.measurement_calculated_values.sds|round(2) }}
                                    </div>
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui header">
                                <div class="content">
                                    Centile
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result %}
                            {% if measurement.child_observation_value.measurement_type == 'bmi' %}
                                    <td>
                                        <div class="ui blue header">
                                            {% if (measurement.measurement_calculated_values.centile >99 and measurement.measurement_calculated_values.centile < 100) or (measurement.measurement_calculated_values.centile < 1 and measurement.measurement_calculated_values.centile > 0) %}
                                                {{ measurement.measurement_calculated_values.centile|round(1) }}
                                            {% elif measurement.measurement_calculated_values.centile >= 100 %}
                                                >99.6<sup>th</sup>
                                            {% elif measurement.measurement_calculated_values.centile <= 0%}
                                                < 0.4<sup>th</sup>
                                            {% else %}
                                                {{ measurement.measurement_calculated_values.centile|round|int}}
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td id='bmi_centile' style=" border: 0px !important;">
                                        <i class="info green circle icon"></i>
                                    </td>
                                {% endif %}

                            {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui blue header">
                                <div class="content">
                                    Head Circumference
                                    <div class="sub header">
                                    </div>
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result %}
                            {% if measurement.child_observation_value.measurement_type == 'ofc' %}
                                <td>
                                    {{ measurement.child_observation_value.measurement_value }} cm
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui header">
                                <div class="content">
                                    SDS
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result %}
                            {% if measurement.child_observation_value.measurement_type == 'ofc' %}
                                <td>
                                    <div>
                                        {{ measurement.measurement_calculated_values.sds|round(2) }}
                                    </div>
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <td>
                            <h4 class="ui header">
                                <div class="content">
                                    Centile
                                </div>
                            </h4>
                        </td>
                        {% for measurement in result  %}
                            {% if measurement.child_observation_value.measurement_type == 'ofc' %}
                                <td>
                                    <div class="ui blue header">
                                        {% if (measurement.measurement_calculated_values.centile >99 and measurement.measurement_calculated_values.centile < 100) or (measurement.measurement_calculated_values.centile < 1 and measurement.measurement_calculated_values.centile > 0) %}
                                            {{ measurement.measurement_calculated_values.centile|round(1) }}
                                        {% elif measurement.measurement_calculated_values.centile >= 100 %}
                                            >99.6<sup>th</sup>
                                        {% elif measurement.measurement_calculated_values.centile <= 0%}
                                            < 0.4<sup>th</sup>
                                        {% else %}
                                            {{ measurement.measurement_calculated_values.centile|round|int}}
                                        {% endif %}
                                    </div>
                                </td>
                                <td id='ofc_centile' style=" border: 0px !important; ">
                                    <i class="info green circle icon"></i>
                                </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="ui container">
            <div class="ui green button" onclick="window.location.href='{{url_for('chart')}}'" type='submit'>Chart</div>
        </div>
    {% endif %}
    <script>
        $('#gestational_age_delivery_explain').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Info: </b>This is the child\'s gestation at birth; it is the number of weeks since the last menstrual period.</p>'
        });
        $('#corrected_decimal_age_explain').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Info: </b>This calculates the child\'s age from their expected due date, not their date of birth. This allows clinicians to compare them with other term babies the same age. It is considered 0 at term (37-42 weeks)</p>'
        });
        $('#chronological_decimal_age_explain').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Info: </b>This reports the child\'s age from birth in years, expressed as a decimal.</p>'
        });
        $('#chronological_calendar_age_explain').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Info: </b>This is the child\'s age from birth in years, months, weeks and days.</p>'
        });
        $('#corrected_calendar_age_explain').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Info: </b>This is the child\'s age from their due date in years, months, weeks and days.</p>'
        });
        $('#estimated_date_delivery_explain').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Info: </b>This is the child\'s due date.</p>'
        });
        $('#corrected_gestational_age_explain').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Info: </b>For babies born preterm, this is their gestational age since birth up until 42 weeks.</p>'
        });
        $('#corrected_decimal_age').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: "<p><b>Clinician: </b>{{result[0].measurement_dates.clinician_decimal_age_comment}}</p><p><b>Parent/Carer:</b> {{result[0].measurement_dates.lay_decimal_age_comment}}</p>"
        });
        $('#height_centile').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Clinician: </b>{% for measurement in result %}{% if measurement.measurement_calculated_values.clinician_height_comment and measurement.child_observation_value.clinician_height_comment is not none %}{{measurement.measurement_calculated_values.clinician_height_comment}}</p><p><b>Parent/Carer:</b> {{measurement.measurement_calculated_values.lay_height_comment}}{%endif%}{%endfor%}</p>'
        });
        $('#weight_centile').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Clinician: </b>{% for measurement in result %}{% if measurement.measurement_calculated_values.clinician_weight_comment and measurement.child_observation_value.clinician_weight_comment is not none %}{{measurement.measurement_calculated_values.clinician_weight_comment}}</p><p><b>Parent/Carer:</b> {{measurement.measurement_calculated_values.lay_weight_comment}}{%endif%}{%endfor%}</p>'
        });
        $('#bmi_centile').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Clinician: </b>{% for measurement in result %}{% if measurement.measurement_calculated_values.clinician_bmi_comment and measurement.child_observation_value.clinician_bmi_comment is not none %}{{measurement.measurement_calculated_values.clinician_bmi_comment}}</p><p><b>Parent/Carer:</b> {{measurement.measurement_calculated_values.lay_bmi_comment}}{%endif%}{%endfor%}</p>'
        });
        $('#ofc_centile').popup({
            on: 'click',
            setFluidWidth: true,
            variation: 'wide green',
            html: '<p><b>Clinician: </b>{% for measurement in result %}{% if measurement.measurement_calculated_values.clinician_ofc_comment and measurement.child_observation_value.clinician_ofc_comment is not none %}{{measurement.measurement_calculated_values.clinician_ofc_comment}}</p><p><b>Parent/Carer:</b> {{measurement.measurement_calculated_values.lay_ofc_comment}}{%endif%}{%endfor%}</p>'
        });

        function returnComment(array, measurement, clinician) {
            for(record in array) {
                console.log(record.measurement_calculated_values.clinician_bmi_comment);
                
            }
        }

    </script>
                
{% endblock %}
